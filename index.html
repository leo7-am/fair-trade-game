<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>The Fair Trade Myth</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:opsz,wght@9..40,400;9..40,700;9..40,900&family=Playfair+Display:ital,wght@0,400;0,700&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
<style>
  :root {
    --earth:#2d1810; --earth-light:#4a2c1a; --coffee:#6f4e37; --coffee-light:#8b6914;
    --cream:#f5e6d3; --gold:#d4af37; --gold-bright:#ffd700;
    --leaf:#3d6b4f; --leaf-bright:#5fa67a;
    --danger:#c14f4f; --danger-bright:#e85a5a;
    --text:#f0e6d8; --text-muted:#a89b8c; --night:#0a0a12;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{
    height:100vh;width:100vw;
    overflow:hidden!important;
    background:var(--night);color:var(--text);
    font-family:'DM Sans',sans-serif;
    -webkit-user-select:none;user-select:none;
    -webkit-tap-highlight-color:transparent;
    touch-action:manipulation;
  }
  
  .world-bg{position:fixed;inset:0;z-index:-10;
    background:radial-gradient(ellipse 80% 50% at 20% 80%, rgba(111,78,55,0.15), transparent 50%),
    radial-gradient(ellipse 60% 40% at 80% 20%, rgba(61,107,79,0.12), transparent 40%),
    linear-gradient(180deg, #0a0a12 0%, #1a1510 100%)}
  
  /* HUD */
  .hud{position:fixed;top:0;left:0;right:0;height:60px;background:rgba(10,10,18,0.9);z-index:100;display:flex;align-items:center;justify-content:space-between;padding:0 32px}
  .hud-logo{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:3px;color:var(--gold)}
  .progress-track{width:200px;height:8px;background:rgba(255,255,255,0.1);border-radius:8px;overflow:hidden;margin-left:24px}
  .progress-fill{height:100%;width:0;background:var(--gold);border-radius:8px;transition:width 0.5s}
  .hud-right{display:flex;gap:24px;align-items:center}
  .stat{font-family:'JetBrains Mono',monospace;font-size:24px;font-weight:700}
  .stat.score{color:var(--gold)}
  .stat.knowledge{color:var(--leaf-bright)}
  .stat-label{font-size:12px;color:var(--text-muted);text-transform:uppercase;margin-right:8px}
  
  /* Stage */
  .stage{position:fixed;top:60px;left:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center;padding:24px 48px;overflow-y:auto;overflow-x:hidden}
  .screen{display:none;width:100%;min-height:100%;animation:fadeIn 0.4s ease}
  .screen.active{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px 0}
  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  
  /* Scrollable content wrapper */
  .scroll-content{width:100%;max-height:100%;display:flex;flex-direction:column;align-items:center}
  
  /* Typography - LARGE */
  .title{font-family:'Bebas Neue',sans-serif;font-size:clamp(80px,12vw,160px);letter-spacing:6px;line-height:0.9;color:var(--gold);text-align:center}
  .headline{font-family:'Playfair Display',serif;font-size:clamp(36px,5vw,56px);color:var(--cream);text-align:center}
  .subtext{font-size:clamp(22px,2.5vw,32px);color:var(--text-muted);text-align:center;margin-top:16px;max-width:900px;line-height:1.4}
  
  /* Buttons - LARGE & Touch-friendly */
  .btn{padding:20px 56px;border:none;border-radius:16px;font-family:'DM Sans',sans-serif;font-weight:700;font-size:clamp(20px,2.5vw,28px);cursor:pointer;transition:transform 0.2s,opacity 0.2s;touch-action:manipulation;-webkit-tap-highlight-color:transparent;min-height:60px}
  .btn:hover{opacity:0.9}
  .btn:active{transform:scale(0.97);opacity:0.8}
  .btn-gold{background:var(--gold);color:var(--earth)}
  .btn-leaf{background:var(--leaf-bright);color:white}
  .btn-ghost{background:transparent;border:3px solid rgba(255,255,255,0.3);color:var(--text-muted)}
  .btn-ghost:hover{border-color:rgba(255,255,255,0.5)}
  .btn-row{display:flex;gap:24px;margin-top:32px;flex-wrap:wrap;justify-content:center}

  /* Name Input */
  .input-name{
    padding:18px 28px;
    font-size:24px;
    font-family:'DM Sans',sans-serif;
    font-weight:700;
    background:rgba(255,255,255,0.05);
    border:3px solid rgba(255,255,255,0.2);
    border-radius:16px;
    color:var(--cream);
    text-align:center;
    outline:none;
    width:100%;
    max-width:400px;
    transition:border-color 0.3s;
  }
  .input-name:focus{border-color:var(--gold)}
  .input-name::placeholder{color:var(--text-muted)}
  
  /* Story Character */
  .character{display:flex;align-items:flex-start;gap:24px;max-width:900px;margin-top:24px}
  .char-avatar{width:100px;height:100px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--coffee));display:flex;align-items:center;justify-content:center;font-size:48px;flex-shrink:0;border:4px solid rgba(255,255,255,0.1)}
  .char-bubble{background:rgba(255,255,255,0.05);border-radius:20px;padding:24px 28px;position:relative;flex:1}
  .char-bubble::before{content:'';position:absolute;left:-12px;top:30px;border:12px solid transparent;border-right-color:rgba(255,255,255,0.05)}
  .char-name{font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--gold);margin-bottom:8px}
  .char-text{font-size:20px;color:var(--text-muted);line-height:1.5}
  
  /* Story Choices - Touch-friendly */
  .story-choices{display:flex;flex-direction:column;gap:16px;margin-top:24px;width:100%;max-width:700px}
  .story-choice{padding:20px 28px;background:rgba(255,255,255,0.03);border:3px solid rgba(255,255,255,0.1);border-radius:16px;cursor:pointer;text-align:left;font-size:20px;font-weight:700;transition:all 0.3s;display:flex;align-items:center;gap:16px;touch-action:manipulation;-webkit-tap-highlight-color:transparent;min-height:70px}
  .story-choice:hover,.story-choice:active{border-color:var(--gold);background:rgba(212,175,55,0.1);transform:translateX(8px)}
  .choice-icon{font-size:28px;flex-shrink:0}
  
  /* Product Cards - Touch-friendly */
  .products{display:flex;gap:48px;margin-top:32px;flex-wrap:wrap;justify-content:center}
  .product{width:380px;background:rgba(45,24,16,0.9);border-radius:28px;padding:36px;border:4px solid transparent;cursor:pointer;text-align:center;transition:all 0.3s;touch-action:manipulation;-webkit-tap-highlight-color:transparent}
  .product:hover,.product:active{transform:translateY(-8px);border-color:var(--gold)}
  .product.fair{border-color:rgba(95,166,122,0.4)}
  .product.fair:hover,.product.fair:active{border-color:var(--leaf-bright)}
  .product-icon{font-size:80px}
  .product-name{font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;margin-top:8px}
  .product-badge{display:inline-block;padding:10px 20px;border-radius:24px;font-weight:700;font-size:18px;margin:16px 0}
  .badge-fair{background:var(--leaf-bright);color:white}
  .badge-none{background:rgba(193,79,79,0.3);color:var(--danger-bright)}
  .product-price{font-family:'JetBrains Mono',monospace;font-size:44px;color:var(--gold-bright);font-weight:700}
  
  /* Money Breakdown */
  .breakdown{display:flex;gap:48px;align-items:center;width:100%;max-width:1200px}
  .pie-wrap{position:relative;width:280px;height:280px;flex-shrink:0}
  .pie{width:100%;height:100%;border-radius:50%;box-shadow:0 10px 40px rgba(0,0,0,0.5)}
  .pie-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:130px;height:130px;border-radius:50%;background:var(--night);display:flex;flex-direction:column;align-items:center;justify-content:center}
  .pie-label{font-size:14px;color:var(--text-muted);text-transform:uppercase}
  .pie-value{font-family:'JetBrains Mono',monospace;font-size:44px;font-weight:700;color:var(--danger-bright)}
  
  .bars{flex:1;display:flex;flex-direction:column;gap:16px}
  .bar-row{display:flex;align-items:center;gap:16px}
  .bar-label{width:120px;font-weight:700;font-size:18px;text-transform:uppercase}
  .bar-track{flex:1;height:48px;background:rgba(255,255,255,0.05);border-radius:12px;overflow:hidden}
  .bar-fill{height:100%;width:0;transition:width 1s ease-out}
  .bar-fill.retailer{background:var(--coffee-light)}
  .bar-fill.brand{background:var(--earth-light)}
  .bar-fill.shipping{background:#555}
  .bar-fill.farmer{background:var(--danger-bright)}
  .bar-pct{font-family:'JetBrains Mono',monospace;font-size:24px;font-weight:700;min-width:80px;text-align:right}
  
  .farmer-box{margin-left:32px;padding:24px 32px;background:rgba(193,79,79,0.15);border:3px solid var(--danger);border-radius:20px;text-align:center}
  .farmer-title{font-size:18px;color:var(--danger-bright);text-transform:uppercase;letter-spacing:1px}
  .farmer-amount{font-family:'JetBrains Mono',monospace;font-size:56px;font-weight:700;color:var(--danger-bright)}
  
  /* Facts */
  .facts{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:24px;max-width:1100px}
  .fact{background:rgba(255,255,255,0.03);border-radius:20px;padding:24px 28px;border-left:5px solid var(--danger);text-align:left}
  .fact-title{font-family:'Bebas Neue',sans-serif;font-size:24px;color:var(--danger-bright);margin-bottom:8px}
  .fact-desc{font-size:20px;color:var(--text-muted);line-height:1.4}
  
  /* Quiz */
  .quiz-box{background:rgba(45,24,16,0.9);border-radius:28px;padding:40px 48px;max-width:900px;width:100%}
  .quiz-q{font-family:'Playfair Display',serif;font-size:clamp(28px,3.5vw,40px);text-align:center;margin-bottom:32px}
  .quiz-opts{display:grid;grid-template-columns:1fr 1fr;gap:20px}
  .quiz-opt{display:flex;align-items:center;gap:16px;padding:20px 24px;background:rgba(255,255,255,0.03);border:3px solid rgba(255,255,255,0.1);border-radius:16px;cursor:pointer;font-size:22px;font-weight:700;transition:all 0.2s;touch-action:manipulation;-webkit-tap-highlight-color:transparent;min-height:70px}
  .quiz-opt:hover,.quiz-opt:active{border-color:rgba(255,255,255,0.3)}
  .quiz-opt.selected{border-color:var(--gold);background:rgba(212,175,55,0.1)}
  .quiz-opt.correct{border-color:var(--leaf-bright);background:rgba(95,166,122,0.2)}
  .quiz-opt.wrong{border-color:var(--danger);background:rgba(193,79,79,0.2)}
  .quiz-dot{width:24px;height:24px;border-radius:50%;border:3px solid rgba(255,255,255,0.3);flex-shrink:0}
  .quiz-opt.selected .quiz-dot{background:var(--gold);border-color:var(--gold)}
  .quiz-feedback{margin-top:24px;padding:20px;border-radius:16px;text-align:center;font-size:22px;font-weight:700;display:none}
  .quiz-feedback.show{display:block}
  .quiz-feedback.correct{background:rgba(95,166,122,0.2);color:var(--leaf-bright)}
  .quiz-feedback.wrong{background:rgba(193,79,79,0.2);color:var(--danger-bright)}
  .quiz-progress{display:flex;gap:12px;justify-content:center;margin-bottom:24px}
  .q-dot{width:60px;height:8px;border-radius:4px;background:rgba(255,255,255,0.1)}
  .q-dot.done{background:var(--leaf-bright)}
  .q-dot.current{background:var(--gold)}
  
  /* Solutions - Touch-friendly */
  .solutions{display:flex;gap:24px;margin-top:24px;flex-wrap:wrap;justify-content:center}
  .sol-card{flex:1;min-width:150px;max-width:200px;background:rgba(61,107,79,0.15);border:3px solid rgba(95,166,122,0.3);border-radius:20px;padding:28px;cursor:pointer;text-align:center;transition:all 0.3s;touch-action:manipulation;-webkit-tap-highlight-color:transparent}
  .sol-card:hover,.sol-card:active,.sol-card.active{border-color:var(--leaf-bright);transform:translateY(-4px)}
  .sol-icon{font-size:48px;margin-bottom:8px}
  .sol-title{font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--leaf-bright)}
  .sol-detail{margin-top:24px;padding:28px;background:rgba(255,255,255,0.03);border-radius:20px;max-width:900px;display:none}
  .sol-detail.active{display:block}
  .sol-detail h3{font-family:'Playfair Display',serif;font-size:28px;color:var(--cream);margin-bottom:16px}
  .sol-detail ul{list-style:none;columns:2;gap:32px}
  .sol-detail li{font-size:20px;color:var(--text-muted);margin-bottom:12px;display:flex;gap:12px}
  .sol-detail li::before{content:'‚Üí';color:var(--leaf-bright);font-weight:700}

  /* Citations */
  .citations{display:flex;flex-direction:column;gap:24px}
  .cite-item{background:rgba(255,255,255,0.03);border-radius:16px;padding:24px 28px;border-left:4px solid var(--gold)}
  .cite-author{font-family:'Bebas Neue',sans-serif;font-size:24px;color:var(--gold);margin-bottom:6px}
  .cite-title{font-size:22px;color:var(--cream);font-style:italic;margin-bottom:6px}
  .cite-source{font-size:18px;color:var(--text-muted)}

  /* Achievement Badges */
  .badges-earned{display:flex;gap:16px;justify-content:center;margin:24px 0;flex-wrap:wrap}
  .badge-item{display:flex;flex-direction:column;align-items:center;gap:8px;padding:16px 20px;background:rgba(212,175,55,0.1);border:2px solid var(--gold);border-radius:16px;min-width:120px}
  .badge-item.locked{opacity:0.4;border-color:rgba(255,255,255,0.2);background:rgba(255,255,255,0.02)}
  .badge-icon{font-size:40px}
  .badge-name{font-family:'Bebas Neue',sans-serif;font-size:14px;color:var(--gold);text-align:center}
  .badge-item.locked .badge-name{color:var(--text-muted)}

  /* Summary */
  .summary-stats{display:flex;gap:40px;margin:32px 0}
  .summary-stat{text-align:center}
  .summary-value{font-family:'JetBrains Mono',monospace;font-size:72px;font-weight:700;color:var(--gold)}
  .summary-label{font-size:18px;color:var(--text-muted);text-transform:uppercase;margin-top:4px}
  .takeaways{display:flex;gap:24px;max-width:1200px}
  .takeaway{flex:1;background:rgba(255,255,255,0.03);border-radius:16px;padding:24px;text-align:center}
  .takeaway-num{font-family:'Bebas Neue',sans-serif;font-size:48px;color:var(--gold)}
  .takeaway-text{font-size:20px;color:var(--text-muted);margin-top:8px;line-height:1.4}

  /* Certificate */
  .certificate{background:linear-gradient(135deg,#f5e6d3,#e8d4b8);border-radius:20px;padding:40px;max-width:700px;width:100%;text-align:center;color:var(--earth);position:relative;box-shadow:0 20px 60px rgba(0,0,0,0.5)}
  .cert-border{position:absolute;inset:12px;border:3px solid var(--gold);border-radius:12px;pointer-events:none}
  .cert-header{font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:4px;color:var(--coffee);margin-bottom:8px}
  .cert-title{font-family:'Playfair Display',serif;font-size:36px;color:var(--earth);margin-bottom:16px}
  .cert-name{font-family:'Bebas Neue',sans-serif;font-size:48px;color:var(--gold);margin:16px 0}
  .cert-desc{font-size:18px;color:var(--coffee);margin-bottom:24px;line-height:1.5}
  .cert-badges{display:flex;justify-content:center;gap:24px;margin:24px 0}
  .cert-badge{display:flex;flex-direction:column;align-items:center;gap:4px}
  .cert-badge-icon{font-size:32px}
  .cert-badge-name{font-size:12px;color:var(--coffee)}
  .cert-footer{display:flex;justify-content:space-between;margin-top:24px;font-size:14px;color:var(--coffee)}
  .cert-score{font-family:'JetBrains Mono',monospace;font-weight:700}
  
  /* Achievement Toast */
  .achievement{position:fixed;bottom:24px;right:24px;background:var(--gold);color:var(--earth);padding:20px 28px;border-radius:16px;display:flex;align-items:center;gap:16px;transform:translateX(400px);transition:transform 0.4s;z-index:200}
  .achievement.show{transform:translateX(0)}
  .achievement-icon{font-size:36px}
  .achievement h4{font-family:'Bebas Neue',sans-serif;font-size:22px}
  .achievement p{font-size:14px;opacity:0.8}

  /* Mobile Responsive */
  @media(max-width:900px){
    .hud{height:50px;padding:0 16px}
    .hud-logo{font-size:20px;letter-spacing:2px}
    .progress-track{width:100px;margin-left:12px}
    .stat{font-size:18px}
    .stat-label{font-size:10px;margin-right:4px}
    .stage{padding:16px 20px;top:50px;overflow-y:auto;-webkit-overflow-scrolling:touch}
    .screen.active{justify-content:flex-start;padding-top:10px;padding-bottom:30px}
    
    .title{font-size:clamp(48px,14vw,80px)}
    .headline{font-size:clamp(24px,6vw,36px)}
    .subtext{font-size:clamp(16px,4vw,20px);margin-top:12px}
    
    .btn{padding:16px 32px;font-size:clamp(16px,4vw,20px);min-height:54px}
    .btn-row{flex-direction:column;gap:12px;width:100%;max-width:300px}
    .btn-row .btn{width:100%}
    
    .input-name{font-size:20px;padding:14px 20px;max-width:300px}
    
    .character{flex-direction:column;align-items:center;gap:16px;margin-top:16px}
    .char-avatar{width:70px;height:70px;font-size:32px}
    .char-bubble{padding:18px 20px}
    .char-bubble::before{display:none}
    .char-name{font-size:16px}
    .char-text{font-size:16px}
    .story-choices{gap:12px;margin-top:16px}
    .story-choice{padding:16px 20px;font-size:16px;min-height:60px}
    .choice-icon{font-size:22px}
    
    .products{flex-direction:column;gap:20px;margin-top:20px}
    .product{width:100%;max-width:340px;padding:24px}
    .product-icon{font-size:56px}
    .product-name{font-size:28px}
    .product-badge{font-size:14px;padding:8px 16px}
    .product-price{font-size:32px}
    
    .breakdown{flex-direction:column;gap:24px}
    .pie-wrap{width:180px;height:180px}
    .pie-center{width:90px;height:90px}
    .pie-value{font-size:32px}
    .bars{width:100%}
    .bar-row{gap:10px}
    .bar-label{width:80px;font-size:14px}
    .bar-track{height:36px}
    .bar-pct{font-size:18px;min-width:50px}
    .farmer-box{margin-left:0;margin-top:16px;padding:16px 20px}
    .farmer-amount{font-size:40px}
    
    .facts{grid-template-columns:1fr;gap:16px;margin-top:16px}
    .fact{padding:18px 20px}
    .fact-title{font-size:20px}
    .fact-desc{font-size:16px}
    
    .quiz-box{padding:24px 20px}
    .quiz-q{font-size:clamp(20px,5vw,28px);margin-bottom:20px}
    .quiz-opts{grid-template-columns:1fr;gap:12px}
    .quiz-opt{padding:16px 18px;font-size:18px;min-height:60px}
    .quiz-feedback{font-size:18px;padding:16px}
    .q-dot{width:40px;height:6px}
    
    .solutions{flex-wrap:wrap;gap:12px;margin-top:16px}
    .sol-card{flex:1 1 45%;min-width:140px;max-width:none;padding:18px}
    .sol-icon{font-size:36px}
    .sol-title{font-size:18px}
    .sol-detail{padding:20px;margin-top:16px}
    .sol-detail h3{font-size:22px}
    .sol-detail ul{columns:1}
    .sol-detail li{font-size:16px}
    
    .badges-earned{gap:12px}
    .badge-item{padding:12px 14px;min-width:90px}
    .badge-icon{font-size:28px}
    .badge-name{font-size:12px}
    
    .citations{gap:16px}
    .cite-item{padding:18px 20px}
    .cite-author{font-size:20px}
    .cite-title{font-size:18px}
    .cite-source{font-size:14px}
    
    .summary-stats{flex-direction:row;gap:16px;margin:20px 0}
    .summary-stat{padding:16px 12px;flex:1}
    .summary-value{font-size:32px}
    .summary-label{font-size:11px}
    .takeaways{flex-direction:column;gap:12px;width:100%;max-width:400px}
    .takeaway{padding:14px 16px;display:flex;align-items:flex-start;gap:12px}
    .takeaway-num{font-size:28px;line-height:1}
    .takeaway-text{font-size:14px;text-align:left}
    
    .certificate{padding:28px 20px;max-width:100%}
    .cert-title{font-size:28px}
    .cert-name{font-size:36px}
    .cert-desc{font-size:14px}
    .cert-badges{gap:16px;flex-wrap:wrap}
    .cert-badge-icon{font-size:24px}
    
    .achievement{bottom:16px;right:16px;left:16px;padding:16px 20px}
    .achievement-icon{font-size:28px}
    .achievement h4{font-size:18px}
  }

  @media(max-width:480px){
    .hud{height:44px;padding:0 12px}
    .hud-logo{font-size:14px;letter-spacing:1px}
    .progress-track{width:50px;height:6px}
    .stat{font-size:14px}
    .stat-label{display:none}
    .hud-right{gap:8px}
    .stage{padding:12px 16px;top:44px}
    .screen.active{padding-bottom:40px}
    
    .title{font-size:clamp(36px,12vw,56px)}
    .headline{font-size:clamp(20px,5.5vw,28px)}
    .subtext{font-size:clamp(14px,3.5vw,18px)}
    
    .btn{padding:14px 24px;min-height:50px}
    .btn-row{gap:10px}
    
    .char-avatar{width:56px;height:56px;font-size:26px}
    .char-bubble{padding:14px 16px}
    .char-text{font-size:14px}
    .story-choice{padding:14px 16px;font-size:14px;min-height:54px}
    .choice-icon{font-size:20px}
    
    .product{padding:20px}
    .product-icon{font-size:48px}
    .product-name{font-size:24px}
    .product-price{font-size:28px}
    
    .pie-wrap{width:120px;height:120px}
    .pie-center{width:60px;height:60px}
    .pie-value{font-size:20px}
    .pie-label{font-size:9px}
    .bar-label{width:55px;font-size:11px}
    .bar-track{height:24px}
    .bar-pct{font-size:12px;min-width:36px}
    .farmer-box{padding:12px 16px}
    .farmer-amount{font-size:28px}
    .farmer-title{font-size:12px}
    
    .facts{gap:12px}
    .fact{padding:14px 16px}
    .fact-title{font-size:18px}
    .fact-desc{font-size:14px}
    
    .quiz-box{padding:20px 16px}
    .quiz-q{font-size:clamp(16px,4.5vw,22px);margin-bottom:16px}
    .quiz-opt{padding:12px 14px;font-size:14px;gap:10px;min-height:50px}
    .quiz-dot{width:18px;height:18px}
    .quiz-feedback{font-size:14px;padding:12px}
    .q-dot{width:30px;height:5px}
    
    .sol-card{padding:14px;min-width:45%}
    .sol-icon{font-size:28px;margin-bottom:4px}
    .sol-title{font-size:14px}
    .sol-detail{padding:16px}
    .sol-detail h3{font-size:18px}
    .sol-detail li{font-size:14px}
    
    .summary-stats{gap:8px;margin:16px 0}
    .summary-stat{padding:10px 6px}
    .summary-value{font-size:26px}
    .summary-label{font-size:9px}
    .takeaways{gap:10px}
    .takeaway{padding:12px 14px;gap:10px}
    .takeaway-num{font-size:22px}
    .takeaway-text{font-size:12px}
    
    .badges-earned{gap:8px}
    .badge-item{padding:10px 10px;min-width:65px}
    .badge-icon{font-size:22px}
    .badge-name{font-size:9px}
    
    .citations{gap:12px}
    .cite-item{padding:14px 16px}
    .cite-author{font-size:16px}
    .cite-title{font-size:14px}
    .cite-source{font-size:11px}
    
    .certificate{padding:20px 16px}
    .cert-border{inset:8px}
    .cert-header{font-size:12px;letter-spacing:2px}
    .cert-title{font-size:20px}
    .cert-name{font-size:26px}
    .cert-desc{font-size:11px}
    .cert-badges{gap:10px}
    .cert-badge-icon{font-size:18px}
    .cert-badge-name{font-size:9px}
    .cert-footer{font-size:10px;flex-direction:column;gap:4px;align-items:center}
    
    .achievement{padding:14px 16px}
    .achievement-icon{font-size:24px}
    .achievement h4{font-size:16px}
    .achievement p{font-size:12px}
  }
</style>
</head>
<body>

<div class="world-bg"></div>

<header class="hud">
  <div style="display:flex;align-items:center">
    <div class="hud-logo">FAIR TRADE MYTH</div>
    <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
  </div>
  <div class="hud-right">
    <span class="stat-label">Score</span><span class="stat score" id="scoreValue">0</span>
    <span class="stat-label" style="margin-left:24px">Knowledge</span><span class="stat knowledge" id="knowledgeValue">0%</span>
  </div>
</header>

<div class="achievement" id="achievement">
  <div class="achievement-icon" id="achIcon">üèÜ</div>
  <div>
    <h4 id="achievementTitle">Achievement!</h4>
    <p id="achievementDesc"></p>
  </div>
</div>

<main class="stage">

  <!-- SCREEN 0: Title -->
  <section id="screen-0" class="screen active">
    <h1 class="title">THE FAIR TRADE MYTH</h1>
    <p class="subtext">Discover where your coffee money really goes</p>
    <div class="name-input" style="margin-top:32px">
      <input type="text" id="playerName" value="Leo" class="input-name">
    </div>
    <div class="btn-row">
      <button class="btn btn-gold" onclick="startGame()">‚òï Start</button>
    </div>
  </section>

  <!-- SCREEN 1: Intro with Amara -->
  <section id="screen-1" class="screen">
    <h2 class="headline">Welcome, <span id="displayName">Leo</span></h2>
    <div class="character">
      <div class="char-avatar">üë©üèæ‚Äçüåæ</div>
      <div class="char-bubble">
        <div class="char-name">Amara ‚Äî Coffee Farmer, Ethiopia</div>
        <div class="char-text">"Hello! I'm Amara. I've been growing coffee in Sidama for 20 years. Today, I want to show you something important about where your coffee really comes from... and where your money really goes."</div>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-gold" onclick="show(2)">Nice to meet you, Amara ‚Üí</button>
    </div>
  </section>

  <!-- SCREEN 2: Story Choice 1 -->
  <section id="screen-2" class="screen">
    <h2 class="headline">Your Journey Begins</h2>
    <div class="character">
      <div class="char-avatar">üë©üèæ‚Äçüåæ</div>
      <div class="char-bubble">
        <div class="char-name">Amara</div>
        <div class="char-text">"You're in a London supermarket, standing in the coffee aisle. I want you to choose a coffee ‚Äî then I'll show you what happens to your money. Which bag catches your eye?"</div>
      </div>
    </div>
    <div class="products">
      <div class="product fair" onclick="pickProduct('fair')">
        <div class="product-icon">‚òï</div>
        <div class="product-name">ETHIOPIAN FAIR</div>
        <div class="product-badge badge-fair">‚úì FAIR TRADE</div>
        <div class="product-price">¬£4.99</div>
      </div>
      <div class="product" onclick="pickProduct('normal')">
        <div class="product-icon">‚òï</div>
        <div class="product-name">HOUSE BLEND</div>
        <div class="product-badge badge-none">‚úï NO LABEL</div>
        <div class="product-price">¬£2.99</div>
      </div>
    </div>
  </section>

  <!-- SCREEN 3: Money Breakdown -->
  <section id="screen-3" class="screen">
    <h2 class="headline">Where Does Your Money Go?</h2>
    <div class="breakdown" style="margin-top:32px">
      <div class="pie-wrap">
        <div class="pie" id="pie"></div>
        <div class="pie-center">
          <div class="pie-label">Farmer</div>
          <div class="pie-value" id="piePct">0%</div>
        </div>
      </div>
      <div class="bars">
        <div class="bar-row">
          <div class="bar-label" style="color:var(--coffee-light)">Retailer</div>
          <div class="bar-track"><div class="bar-fill retailer" id="bar1"></div></div>
          <div class="bar-pct" id="pct1" style="color:var(--coffee-light)"></div>
        </div>
        <div class="bar-row">
          <div class="bar-label" style="color:var(--earth-light)">Brand</div>
          <div class="bar-track"><div class="bar-fill brand" id="bar2"></div></div>
          <div class="bar-pct" id="pct2" style="color:var(--earth-light)"></div>
        </div>
        <div class="bar-row">
          <div class="bar-label" style="color:#777">Shipping</div>
          <div class="bar-track"><div class="bar-fill shipping" id="bar3"></div></div>
          <div class="bar-pct" id="pct3" style="color:#999"></div>
        </div>
        <div class="bar-row">
          <div class="bar-label" style="color:var(--danger-bright)">Farmer</div>
          <div class="bar-track"><div class="bar-fill farmer" id="bar4"></div></div>
          <div class="bar-pct" id="pct4" style="color:var(--danger-bright)"></div>
        </div>
      </div>
      <div class="farmer-box">
        <div class="farmer-title">Farmer Receives</div>
        <div class="farmer-amount" id="farmerAmt">¬£0.00</div>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-gold" onclick="showStoryReaction()">What does Amara think? ‚Üí</button>
    </div>
  </section>

  <!-- SCREEN 4: Amara's Reaction (Branching) -->
  <section id="screen-4" class="screen">
    <h2 class="headline" id="reactionTitle">Amara's Response</h2>
    <div class="character">
      <div class="char-avatar">üë©üèæ‚Äçüåæ</div>
      <div class="char-bubble">
        <div class="char-name">Amara</div>
        <div class="char-text" id="amaraReaction">Reaction text</div>
      </div>
    </div>
    <div class="story-choices" id="storyChoices">
      <!-- Dynamic choices inserted here -->
    </div>
  </section>

  <!-- SCREEN 5: Facts -->
  <section id="screen-5" class="screen">
    <h2 class="headline" id="factsTitle">The Hidden Truth</h2>
    <div class="facts" id="factsGrid"></div>
    <div class="btn-row">
      <button class="btn btn-gold" onclick="startQuiz()">Test Your Knowledge ‚Üí</button>
    </div>
  </section>

  <!-- SCREEN 6: Quiz -->
  <section id="screen-6" class="screen">
    <div class="quiz-box">
      <div class="quiz-progress" id="quizProgress"></div>
      <p class="quiz-q" id="quizQ">Question?</p>
      <div class="quiz-opts" id="quizOpts"></div>
      <div class="quiz-feedback" id="quizFB"></div>
      <div class="btn-row" id="quizNav"></div>
    </div>
  </section>

  <!-- SCREEN 7: Story Choice 2 - What to do? -->
  <section id="screen-7" class="screen">
    <h2 class="headline">What Will You Do?</h2>
    <div class="character">
      <div class="char-avatar">üë©üèæ‚Äçüåæ</div>
      <div class="char-bubble">
        <div class="char-name">Amara</div>
        <div class="char-text">"Now you know the truth. The question is ‚Äî what can we do about it? I have some ideas, but I want to hear your thoughts first."</div>
      </div>
    </div>
    <div class="story-choices">
      <div class="story-choice" onclick="chooseAction('awareness')">
        <span class="choice-icon">üì¢</span>
        <span>"We need to spread awareness about this!"</span>
      </div>
      <div class="story-choice" onclick="chooseAction('system')">
        <span class="choice-icon">‚öôÔ∏è</span>
        <span>"The whole system needs to change."</span>
      </div>
      <div class="story-choice" onclick="chooseAction('local')">
        <span class="choice-icon">üè≠</span>
        <span>"Farmers should process coffee locally."</span>
      </div>
    </div>
  </section>

  <!-- SCREEN 8: Solutions -->
  <section id="screen-8" class="screen">
    <h2 class="headline">Real Solutions for Real Fairness</h2>
    <div class="character" style="margin-bottom:16px">
      <div class="char-avatar">üë©üèæ‚Äçüåæ</div>
      <div class="char-bubble">
        <div class="char-name">Amara</div>
        <div class="char-text" id="amaraSolution">"Great thinking! Here are the solutions that could actually help farmers like me..."</div>
      </div>
    </div>
    <div class="solutions">
      <div class="sol-card" onclick="showSol('local')" id="sol-local">
        <div class="sol-icon">üè≠</div>
        <div class="sol-title">Local Processing</div>
      </div>
      <div class="sol-card" onclick="showSol('coop')" id="sol-coop">
        <div class="sol-icon">ü§ù</div>
        <div class="sol-title">Farmer Ownership</div>
      </div>
      <div class="sol-card" onclick="showSol('policy')" id="sol-policy">
        <div class="sol-icon">üèõÔ∏è</div>
        <div class="sol-title">Policy Reform</div>
      </div>
      <div class="sol-card" onclick="showSol('cert')" id="sol-cert">
        <div class="sol-icon">üîÑ</div>
        <div class="sol-title">Fair Certification</div>
      </div>
    </div>
    <div class="sol-detail" id="solDetail"></div>
    <div class="btn-row">
      <button class="btn btn-gold" onclick="showSummary()">See Your Results ‚Üí</button>
    </div>
  </section>

  <!-- SCREEN 9: Summary with Badges -->
  <section id="screen-9" class="screen">
    <h2 class="headline">Journey Complete!</h2>
    <div class="badges-earned" id="badgesEarned">
      <!-- Badges inserted dynamically -->
    </div>
    <div class="summary-stats">
      <div class="summary-stat">
        <div class="summary-value" id="finalScore">0</div>
        <div class="summary-label">Points</div>
      </div>
      <div class="summary-stat">
        <div class="summary-value" id="finalKnowledge">0%</div>
        <div class="summary-label">Knowledge</div>
      </div>
      <div class="summary-stat">
        <div class="summary-value" id="finalQuiz">0/3</div>
        <div class="summary-label">Quiz</div>
      </div>
    </div>
    <div class="takeaways">
      <div class="takeaway">
        <div class="takeaway-num">01</div>
        <div class="takeaway-text">Labels don't change who owns processing & branding</div>
      </div>
      <div class="takeaway">
        <div class="takeaway-num">02</div>
        <div class="takeaway-text">Only 6-8% reaches farmers ‚Äî even with certification</div>
      </div>
      <div class="takeaway">
        <div class="takeaway-num">03</div>
        <div class="takeaway-text">Real change = local processing + farmer ownership</div>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-gold" onclick="restart()">Play Again</button>
      <button class="btn btn-ghost" onclick="show(10)">Get Certificate</button>
      <button class="btn btn-ghost" onclick="show(11)">Citations</button>
    </div>
  </section>

  <!-- SCREEN 10: Certificate -->
  <section id="screen-10" class="screen">
    <div class="certificate" id="certificate">
      <div class="cert-border"></div>
      <div class="cert-header">CERTIFICATE OF COMPLETION</div>
      <div class="cert-title">The Fair Trade Myth</div>
      <div class="cert-name" id="certName">Leo</div>
      <div class="cert-desc">has successfully completed the Fair Trade Myth challenge and demonstrated understanding of global trade inequalities and pathways to genuine fairness.</div>
      <div class="cert-badges" id="certBadges">
        <!-- Badges inserted here -->
      </div>
      <div class="cert-footer">
        <span class="cert-score">Score: <span id="certScore">0</span> pts</span>
        <span id="certDate"></span>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-ghost" onclick="show(9)">‚Üê Back</button>
      <button class="btn btn-gold" onclick="downloadCertificate()">üì• Download</button>
    </div>
  </section>

  <!-- SCREEN 11: Citations -->
  <section id="screen-11" class="screen">
    <h2 class="headline">Sources & Citations</h2>
    <div class="citations" style="margin-top:32px;max-width:1000px;text-align:left">
      <div class="cite-item">
        <div class="cite-author">Dammert, A. C. & Mohan, S. (2014)</div>
        <div class="cite-title">A Survey of the Economics of Fair Trade</div>
        <div class="cite-source">IZA Discussion Papers, No. 8167, Institute for the Study of Labor (IZA), Bonn</div>
      </div>
      <div class="cite-item">
        <div class="cite-author">Okanga, B. (2025)</div>
        <div class="cite-title">Foreign aid and Africa's economic independence: The lingering economic paradox for African leaders</div>
        <div class="cite-source">Dutch Journal of Finance and Management, 8(1), 35105</div>
      </div>
      <div class="cite-item">
        <div class="cite-author">Nwafor, A. (2025)</div>
        <div class="cite-title">Economic dimensions of Africa's self-identity crisis: A study of global trade and policy implications</div>
        <div class="cite-source">African and Global Issues Quarterly, 5(1), 59‚Äì79</div>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-ghost" onclick="show(9)">‚Üê Back</button>
    </div>
  </section>

</main>

<script>
const state = { 
  screen:0, 
  product:null, 
  score:0, 
  knowledge:0, 
  qi:0, 
  qc:0, 
  answered:[], 
  currentQuiz:[], 
  playerName:'Leo',
  actionChoice: null,
  badges: {
    explorer: false,    // Started the journey
    truthSeeker: false, // Saw the money breakdown
    scholar: false,     // Got 2+ quiz questions right
    advocate: false,    // Made an action choice
    mythBuster: false   // Completed the game
  }
};

const TOTAL_SCREENS = 12;

// Badge definitions
const badgeDefs = {
  explorer: { icon: 'üß≠', name: 'Explorer', desc: 'Started the journey' },
  truthSeeker: { icon: 'üîç', name: 'Truth Seeker', desc: 'Discovered the money trail' },
  scholar: { icon: 'üìö', name: 'Scholar', desc: 'Aced the quiz' },
  advocate: { icon: 'üì¢', name: 'Advocate', desc: 'Chose to take action' },
  mythBuster: { icon: 'üí°', name: 'Myth Buster', desc: 'Completed the challenge' }
};

// FAIR TRADE quiz
const quizFair = [
  { q:"Who sets Fair Trade certification standards?", opts:["African farmers","Northern organizations","United Nations","Governments"], a:1 },
  { q:"Do certification fees help or burden farmers?", opts:["Help ‚Äî they're free","Burden ‚Äî farmers pay them","No fees exist","Governments pay"], a:1 },
  { q:"Does a Fair Trade label mean farmers control processing?", opts:["Yes, always","No ‚Äî ownership unchanged","Only in Africa","Only for coffee"], a:1 }
];

// NORMAL quiz
const quizNormal = [
  { q:"What happens to farmers when prices are low?", opts:["They're protected","They absorb all the risk","Brands help them","Nothing changes"], a:1 },
  { q:"Who captures most value in the supply chain?", opts:["Farmers","Retailers & brands","Shipping companies","Consumers"], a:1 },
  { q:"Can buying cheap coffee alone fix the system?", opts:["Yes, markets adjust","No ‚Äî structural change needed","Only if everyone does it","Prices don't matter"], a:1 }
];

const sols = {
  local: { t:"Local Processing", p:["Roast & pack where coffee grows","Export finished products, not raw beans","Build local quality control","Keep more value in Africa"] },
  coop: { t:"Farmer Ownership", p:["Farmers own the roasteries","Farmers own the brands","Revenue goes to members","Direct deals with retailers"] },
  policy: { t:"Policy Reform", p:["Tax breaks for local processing","Regional trade agreements","Infrastructure investment","Procurement rules favoring origin"] },
  cert: { t:"Fair Certification", p:["Lower certification fees","African-led verification","Transparent accounting","Long-term contracts"] }
};

function show(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-'+id).classList.add('active');
  state.screen = id;
  document.getElementById('progressFill').style.width = (id/(TOTAL_SCREENS-1))*100+'%';
}

function addScore(n) { state.score += n; document.getElementById('scoreValue').textContent = state.score; }
function addKnow(n) { state.knowledge = Math.min(100, state.knowledge + n); document.getElementById('knowledgeValue').textContent = state.knowledge+'%'; }

function unlockBadge(key) {
  if (state.badges[key]) return; // Already unlocked
  state.badges[key] = true;
  const badge = badgeDefs[key];
  toast(badge.icon, badge.name, badge.desc);
}

function toast(icon, title, desc) {
  document.getElementById('achIcon').textContent = icon || 'üèÜ';
  document.getElementById('achievementTitle').textContent = title;
  document.getElementById('achievementDesc').textContent = desc || '';
  document.getElementById('achievement').classList.add('show');
  setTimeout(() => document.getElementById('achievement').classList.remove('show'), 3000);
}

function startGame() { 
  const nameInput = document.getElementById('playerName').value.trim();
  state.playerName = nameInput || 'Leo';
  document.getElementById('displayName').textContent = state.playerName;
  show(1); 
  addScore(5); 
  addKnow(5);
  unlockBadge('explorer');
}

function pickProduct(p) {
  state.product = p;
  state.currentQuiz = (p === 'fair') ? quizFair : quizNormal;
  addScore(10); addKnow(10);
  show(3);
  setTimeout(() => {
    const price = p === 'fair' ? 4.99 : 2.99;
    const b = p === 'fair' ? {r:50,b:30,s:14,f:6} : {r:55,b:25,s:12,f:8};
    setTimeout(() => { document.getElementById('bar1').style.width = b.r+'%'; document.getElementById('pct1').textContent = b.r+'%'; }, 100);
    setTimeout(() => { document.getElementById('bar2').style.width = b.b+'%'; document.getElementById('pct2').textContent = b.b+'%'; }, 250);
    setTimeout(() => { document.getElementById('bar3').style.width = b.s+'%'; document.getElementById('pct3').textContent = b.s+'%'; }, 400);
    setTimeout(() => { document.getElementById('bar4').style.width = b.f+'%'; document.getElementById('pct4').textContent = b.f+'%'; }, 550);
    document.getElementById('pie').style.background = `conic-gradient(var(--coffee-light) 0 ${b.r*3.6}deg, var(--earth-light) 0 ${(b.r+b.b)*3.6}deg, #555 0 ${(b.r+b.b+b.s)*3.6}deg, var(--danger-bright) 0 360deg)`;
    document.getElementById('piePct').textContent = b.f+'%';
    document.getElementById('farmerAmt').textContent = '¬£'+(price*b.f/100).toFixed(2);
    
    // Unlock badge after seeing breakdown
    setTimeout(() => unlockBadge('truthSeeker'), 1500);
  }, 300);
}

function showStoryReaction() {
  show(4);
  addKnow(5);
  
  const reactionEl = document.getElementById('amaraReaction');
  const choicesEl = document.getElementById('storyChoices');
  
  if (state.product === 'fair') {
    document.getElementById('reactionTitle').textContent = "Amara's Thoughts on Fair Trade";
    reactionEl.innerHTML = `"You chose the Fair Trade bag. Many people think that helps farmers like me. But let me tell you a secret... <strong>I still only got ${(4.99 * 0.06).toFixed(2)} pounds</strong> from that sale. The certification costs me money, and the standards? They were written in Europe, not here in Ethiopia."`;
    choicesEl.innerHTML = `
      <div class="story-choice" onclick="storyChoice('surprised')">
        <span class="choice-icon">üòÆ</span>
        <span>"That's shocking! I thought Fair Trade meant fair..."</span>
      </div>
      <div class="story-choice" onclick="storyChoice('curious')">
        <span class="choice-icon">ü§î</span>
        <span>"Why doesn't more money reach you?"</span>
      </div>
      <div class="story-choice" onclick="storyChoice('angry')">
        <span class="choice-icon">üò§</span>
        <span>"That's not right. Who's taking all the money?"</span>
      </div>
    `;
  } else {
    document.getElementById('reactionTitle').textContent = "Amara's Thoughts on Cheap Coffee";
    reactionEl.innerHTML = `"You chose the cheaper bag. I understand ‚Äî price matters. But here's the truth: <strong>I got even less</strong> from that one. When prices are pushed down, we farmers feel it first. There's no safety net for us."`;
    choicesEl.innerHTML = `
      <div class="story-choice" onclick="storyChoice('guilty')">
        <span class="choice-icon">üòî</span>
        <span>"I feel bad now... I didn't know."</span>
      </div>
      <div class="story-choice" onclick="storyChoice('curious')">
        <span class="choice-icon">ü§î</span>
        <span>"Why is the system set up this way?"</span>
      </div>
      <div class="story-choice" onclick="storyChoice('practical')">
        <span class="choice-icon">üí≠</span>
        <span>"What can consumers actually do?"</span>
      </div>
    `;
  }
}

function storyChoice(choice) {
  addScore(10);
  addKnow(10);
  showFacts();
}

function showFacts() {
  show(5);
  const g = document.getElementById('factsGrid');
  const titleEl = document.getElementById('factsTitle');
  
  if (state.product === 'fair') {
    titleEl.textContent = 'The Fair Trade Reality';
    const f = [
      {t:'Certification Costs',d:'Farmers pay expensive fees to access "fair" markets'},
      {t:'Premium Capture',d:'Retailers & brands take most of the premium'},
      {t:'Northern Rules',d:'Standards set in Europe, not by African producers'},
      {t:'Label ‚â† Control',d:'Labels don\'t change who owns processing & branding'}
    ];
    g.innerHTML = f.map(x => `<div class="fact"><div class="fact-title">${x.t}</div><p class="fact-desc">${x.d}</p></div>`).join('');
  } else {
    titleEl.textContent = 'The Cheap Coffee Reality';
    const f = [
      {t:'Price Pressure',d:'Low prices squeeze farmers hardest of all'},
      {t:'No Safety Net',d:'Without premiums, farmers absorb all market risk'},
      {t:'Power Imbalance',d:'Brands & retailers control the entire supply chain'},
      {t:'Raw Export Trap',d:'Value is added elsewhere, never at origin'}
    ];
    g.innerHTML = f.map(x => `<div class="fact"><div class="fact-title">${x.t}</div><p class="fact-desc">${x.d}</p></div>`).join('');
  }
}

function startQuiz() { 
  state.qi = 0; 
  state.qc = 0; 
  state.answered = []; 
  show(6); 
  renderQ(); 
}

function renderQ() {
  const q = state.currentQuiz[state.qi];
  document.getElementById('quizProgress').innerHTML = state.currentQuiz.map((_,i) => `<div class="q-dot ${i<state.qi?'done':''} ${i===state.qi?'current':''}"></div>`).join('');
  document.getElementById('quizQ').textContent = q.q;
  document.getElementById('quizOpts').innerHTML = q.opts.map((o,i) => `<div class="quiz-opt" onclick="selOpt(${i})"><div class="quiz-dot"></div><span>${o}</span></div>`).join('');
  document.getElementById('quizFB').className = 'quiz-feedback';
  document.getElementById('quizNav').innerHTML = '<button class="btn btn-gold" onclick="checkAns()">Check</button>';
}

function selOpt(i) {
  if (state.answered.includes(state.qi)) return;
  document.querySelectorAll('.quiz-opt').forEach((el,j) => el.classList.toggle('selected', j===i));
  state.sel = i;
}

function checkAns() {
  if (state.sel === undefined || state.answered.includes(state.qi)) return;
  state.answered.push(state.qi);
  const q = state.currentQuiz[state.qi];
  const correct = state.sel === q.a;
  if (correct) { state.qc++; addScore(15); }
  addKnow(5);
  document.querySelectorAll('.quiz-opt').forEach((el,i) => {
    if (i === q.a) el.classList.add('correct');
    else if (i === state.sel && !correct) el.classList.add('wrong');
  });
  const fb = document.getElementById('quizFB');
  fb.className = 'quiz-feedback show ' + (correct ? 'correct' : 'wrong');
  fb.textContent = correct ? '‚úì Correct!' : '‚úó Wrong ‚Äî Answer: ' + q.opts[q.a];
  document.getElementById('quizNav').innerHTML = state.qi < state.currentQuiz.length-1 
    ? '<button class="btn btn-gold" onclick="nextQ()">Next ‚Üí</button>'
    : '<button class="btn btn-gold" onclick="finishQuiz()">Continue ‚Üí</button>';
}

function nextQ() { state.qi++; state.sel = undefined; renderQ(); }

function finishQuiz() {
  if (state.qc >= 2) {
    unlockBadge('scholar');
  }
  show(7);
}

function chooseAction(action) {
  state.actionChoice = action;
  addScore(15);
  addKnow(10);
  unlockBadge('advocate');
  
  const responses = {
    awareness: '"Yes! Awareness is the first step. But we also need structural changes..."',
    system: '"Exactly! The system itself is the problem. Let me show you what real change looks like..."',
    local: '"You understand! If we process coffee here in Ethiopia, we keep much more of the value..."'
  };
  
  document.getElementById('amaraSolution').textContent = responses[action];
  show(8);
}

function showSol(k) {
  document.querySelectorAll('.sol-card').forEach(c => c.classList.remove('active'));
  document.getElementById('sol-'+k).classList.add('active');
  const s = sols[k];
  document.getElementById('solDetail').innerHTML = `<h3>${s.t}</h3><ul>${s.p.map(x=>`<li>${x}</li>`).join('')}</ul>`;
  document.getElementById('solDetail').className = 'sol-detail active';
}

function showSummary() {
  unlockBadge('mythBuster');
  show(9);
  
  document.getElementById('finalScore').textContent = state.score;
  document.getElementById('finalKnowledge').textContent = state.knowledge + '%';
  document.getElementById('finalQuiz').textContent = state.qc + '/' + state.currentQuiz.length;
  
  // Render badges
  const badgesEl = document.getElementById('badgesEarned');
  badgesEl.innerHTML = '';
  for (const [key, unlocked] of Object.entries(state.badges)) {
    const badge = badgeDefs[key];
    badgesEl.innerHTML += `
      <div class="badge-item ${unlocked ? '' : 'locked'}">
        <div class="badge-icon">${badge.icon}</div>
        <div class="badge-name">${badge.name}</div>
      </div>
    `;
  }
  
  // Setup certificate
  document.getElementById('certName').textContent = state.playerName;
  document.getElementById('certScore').textContent = state.score;
  document.getElementById('certDate').textContent = new Date().toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });
  
  // Render certificate badges
  const certBadgesEl = document.getElementById('certBadges');
  certBadgesEl.innerHTML = '';
  for (const [key, unlocked] of Object.entries(state.badges)) {
    if (unlocked) {
      const badge = badgeDefs[key];
      certBadgesEl.innerHTML += `
        <div class="cert-badge">
          <div class="cert-badge-icon">${badge.icon}</div>
          <div class="cert-badge-name">${badge.name}</div>
        </div>
      `;
    }
  }
}

function downloadCertificate() {
  // Create a canvas to render the certificate
  const cert = document.getElementById('certificate');
  
  // Use html2canvas-like approach with SVG
  const earnedBadges = Object.entries(state.badges)
    .filter(([k,v]) => v)
    .map(([k]) => badgeDefs[k]);
  
  const badgesStr = earnedBadges.map(b => `${b.icon} ${b.name}`).join('  ‚Ä¢  ');
  
  const svgContent = `
    <svg xmlns="http://www.w3.org/2000/svg" width="800" height="500">
      <defs>
        <linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#f5e6d3"/>
          <stop offset="100%" style="stop-color:#e8d4b8"/>
        </linearGradient>
      </defs>
      <rect width="800" height="500" fill="url(#bg)" rx="20"/>
      <rect x="15" y="15" width="770" height="470" fill="none" stroke="#d4af37" stroke-width="3" rx="12"/>
      <text x="400" y="60" text-anchor="middle" font-family="Arial" font-size="16" fill="#6f4e37" letter-spacing="4">CERTIFICATE OF COMPLETION</text>
      <text x="400" y="110" text-anchor="middle" font-family="Georgia" font-size="36" fill="#2d1810">The Fair Trade Myth</text>
      <text x="400" y="180" text-anchor="middle" font-family="Arial" font-size="42" fill="#d4af37" font-weight="bold">${state.playerName}</text>
      <text x="400" y="230" text-anchor="middle" font-family="Arial" font-size="14" fill="#6f4e37">has successfully completed the Fair Trade Myth challenge</text>
      <text x="400" y="255" text-anchor="middle" font-family="Arial" font-size="14" fill="#6f4e37">and demonstrated understanding of global trade inequalities.</text>
      <text x="400" y="320" text-anchor="middle" font-family="Arial" font-size="18" fill="#2d1810">${badgesStr}</text>
      <text x="100" y="450" font-family="monospace" font-size="14" fill="#6f4e37" font-weight="bold">Score: ${state.score} pts</text>
      <text x="700" y="450" text-anchor="end" font-family="Arial" font-size="14" fill="#6f4e37">${new Date().toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })}</text>
    </svg>
  `;
  
  const blob = new Blob([svgContent], { type: 'image/svg+xml' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `FairTradeMyth_Certificate_${state.playerName}.svg`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  toast('üì•', 'Downloaded!', 'Certificate saved');
}

function restart() {
  state.screen=0; state.product=null; state.score=0; state.knowledge=0; state.qi=0; state.qc=0; state.answered=[]; state.currentQuiz=[]; state.playerName='Leo'; state.actionChoice=null;
  state.badges = { explorer:false, truthSeeker:false, scholar:false, advocate:false, mythBuster:false };
  document.getElementById('scoreValue').textContent = '0';
  document.getElementById('knowledgeValue').textContent = '0%';
  document.getElementById('playerName').value = 'Leo';
  ['bar1','bar2','bar3','bar4'].forEach(id => document.getElementById(id).style.width = '0%');
  ['pct1','pct2','pct3','pct4'].forEach(id => document.getElementById(id).textContent = '');
  show(0);
}
</script>

</body>
</html>
